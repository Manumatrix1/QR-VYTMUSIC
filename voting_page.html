<!DOCTYPE html>
<html lang="es">
<head>
    </head>
<body>
    <main id="voting-content">
         <div class="text-center mb-6">
            <button id="manage-artists-btn" class="px-4 py-2 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700">Gestionar Artistas</button>
        </div>
        <div id="artists-list-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
    </main>

    <div id="edit-artist-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4">Editar Artista</h3>
            <input type="hidden" id="edit-artist-id">
            <div>
                <label for="edit-artist-name" class="block mb-1 font-semibold">Nombre del Artista</label>
                <input type="text" id="edit-artist-name" class="w-full p-3 rounded-md border border-gray-600 bg-gray-900">
            </div>
            <div class="flex justify-end space-x-4 mt-4">
                <button type="button" id="cancel-edit-btn" class="px-4 py-2 bg-gray-600 rounded-lg">Cancelar</button>
                <button type="button" id="save-edit-btn" class="px-4 py-2 bg-green-600 rounded-lg">Guardar Cambios</button>
            </div>
        </div>
    </div>


    <script type="module">
        // ... (misma configuración de Firebase y estado global)

        function renderArtists(artists) {
            // ... (dentro del bucle forEach de artistas)
            const isManagementMode = document.body.classList.contains('management-mode');

            artistCard.innerHTML = `
                <div class="management-controls ${isManagementMode ? '' : 'hidden'} mt-4 flex gap-2">
                    <button data-artist-id="${artist.id}" class="edit-artist-btn flex-1 px-3 py-1 bg-yellow-500 text-black font-bold rounded">Editar</button>
                    <button data-artist-id="${artist.id}" data-artist-photo="${artist.photoURL}" class="delete-artist-btn flex-1 px-3 py-1 bg-red-600 text-white font-bold rounded">Eliminar</button>
                </div>
            `;
            // ...
        }

        async function deleteArtist(artistId, photoURL) {
            if (!confirm('¿Seguro que quieres eliminar este artista? Se borrarán sus votos y su foto. Esta acción no se puede deshacer.')) return;

            setLoading(true);
            try {
                // Borrar el documento del artista de Firestore
                await deleteDoc(doc(state.db, `artifacts/${state.appId}/public/data/artists`, artistId));

                // Borrar la foto de Firebase Storage
                if (photoURL) {
                    const photoRef = ref(state.storage, photoURL);
                    await deleteObject(photoRef);
                }

                displayMessage('Artista eliminado con éxito.', 'success');
            } catch (error) {
                console.error("Error al eliminar artista:", error);
                displayMessage(`Error: ${error.message}`, 'error');
            } finally {
                setLoading(false);
            }
        }

        async function updateArtistName(artistId, newName) {
             setLoading(true);
             try {
                await updateDoc(doc(state.db, `artifacts/${state.appId}/public/data/artists`, artistId), {
                    name: newName
                });
                displayMessage('Nombre del artista actualizado.', 'success');
                document.getElementById('edit-artist-modal').classList.add('hidden');
             } catch (error) {
                console.error("Error al actualizar artista:", error);
                displayMessage(`Error: ${error.message}`, 'error');
             } finally {
                setLoading(false);
             }
        }


        function setupEventListeners() {
            // ... (otros listeners)

            document.getElementById('manage-artists-btn').addEventListener('click', () => {
                document.body.classList.toggle('management-mode');
                renderArtists(state.artistsData); // Volver a renderizar para mostrar/ocultar controles
            });

            ui.artistsListContainer.addEventListener('click', e => {
                if (e.target.classList.contains('delete-artist-btn')) {
                    const artistId = e.target.dataset.artistId;
                    const photoURL = e.target.dataset.artistPhoto;
                    deleteArtist(artistId, photoURL);
                }
                if (e.target.classList.contains('edit-artist-btn')) {
                    const artistId = e.target.dataset.artistId;
                    const artist = state.artistsData.find(a => a.id === artistId);
                    document.getElementById('edit-artist-id').value = artistId;
                    document.getElementById('edit-artist-name').value = artist.name;
                    document.getElementById('edit-artist-modal').classList.remove('hidden');
                }
            });

            document.getElementById('save-edit-btn').addEventListener('click', () => {
                const artistId = document.getElementById('edit-artist-id').value;
                const newName = document.getElementById('edit-artist-name').value;
                updateArtistName(artistId, newName);
            });
             document.getElementById('cancel-edit-btn').addEventListener('click', () => {
                document.getElementById('edit-artist-modal').classList.add('hidden');
            });
        }

        // ...
    </script>
</body>
</html>