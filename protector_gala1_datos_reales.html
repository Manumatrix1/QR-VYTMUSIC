<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è PROTECTOR GALA 1 - DATOS REALES</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; }
        .glass-bg { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .critical { background: rgba(239, 68, 68, 0.3); border: 2px solid #ef4444; animation: pulse 2s infinite; }
        .safe { background: rgba(16, 185, 129, 0.3); border: 2px solid #10b981; }
        .warning { background: rgba(245, 158, 11, 0.3); border: 2px solid #f59e0b; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
</head>
<body class="glass-bg min-h-screen text-white">
    <div class="container mx-auto px-4 py-8">
        <!-- HEADER CR√çTICO -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold mb-4">üõ°Ô∏è PROTECTOR GALA 1</h1>
            <div class="critical p-6 rounded-lg mb-4">
                <p class="font-bold text-2xl">‚ö†Ô∏è GALA 1 CON PUNTUACI√ìN</p>
                <p class="text-xl">CONTIENE VOTOS REALES - PROTEGIDO</p>
                <p class="text-lg mt-2">Jurados: Eze y Ceci (grupal) + Luciano (secreto)</p>
            </div>
        </div>

        <!-- ESTADO EN TIEMPO REAL -->
        <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">üìä Estado de Datos Reales</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- JURADOS CR√çTICOS -->
                <div class="critical p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2">üë• JURADOS SEGUROS</h3>
                    <div id="jurados-status" class="space-y-2">
                        <div class="flex justify-between">
                            <span>Eze y Ceci (Grupal):</span>
                            <span id="eze-ceci-status">Verificando...</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Luciano (Secreto):</span>
                            <span id="luciano-status">Verificando...</span>
                        </div>
                    </div>
                </div>

                <!-- DATOS REALES -->
                <div class="warning p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-2">üó≥Ô∏è VOTOS REALES</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>Votos de Jurados:</span>
                            <span id="jury-votes" class="font-bold">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Votos P√∫blicos:</span>
                            <span id="public-votes" class="font-bold">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Total Artistas:</span>
                            <span id="total-artists" class="font-bold">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACCIONES DE PROTECCI√ìN -->
        <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">üîí Acciones de Protecci√≥n</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="verificarTodo()" class="bg-red-600 hover:bg-red-700 py-3 px-6 rounded-lg font-bold">
                    üîç VERIFICAR ESTADO
                </button>
                <button onclick="backupEmergencia()" class="bg-purple-600 hover:bg-purple-700 py-3 px-6 rounded-lg font-bold">
                    üíæ BACKUP EMERGENCIA
                </button>
                <button onclick="restaurarJurados()" class="bg-green-600 hover:bg-green-700 py-3 px-6 rounded-lg font-bold">
                    ‚ôªÔ∏è RESTAURAR JURADOS
                </button>
                <button onclick="reporteSeguridad()" class="bg-blue-600 hover:bg-blue-700 py-3 px-6 rounded-lg font-bold">
                    üìã REPORTE SEGURIDAD
                </button>
            </div>
        </div>

        <!-- LOG CR√çTICO -->
        <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <h2 class="text-2xl font-bold mb-4">üìù Log de Protecci√≥n</h2>
            <div id="protection-log" class="bg-black/50 p-4 rounded-lg h-48 overflow-y-auto font-mono text-sm">
                <p class="text-red-400">[CR√çTICO] Sistema de protecci√≥n GALA 1 iniciado</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { db } from './firebase_config.js';
        import { collection, getDocs, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // CONFIGURACI√ìN CR√çTICA - GALA 1
        const GALA1_CONFIG = {
            eventId: 'vIINfBwQaFsIhNOYWPtS',
            eventName: 'GALA 1 CON PUNTUACI√ìN. G12 VYTMUSIC',
            jurados: {
                'eze_ceci_grupal': {
                    nombre: 'Eze y Ceci',
                    tipo: 'grupal',
                    data: {
                        id: "eze_ceci_grupal",
                        name: "Eze y Ceci",
                        displayName: "Eze y Ceci",
                        username: "eze_ceci_grupal",
                        type: "grupal",
                        category: "Jurado Grupal",
                        active: true,
                        canVote: true,
                        canComment: true,
                        eventId: 'vIINfBwQaFsIhNOYWPtS',
                        backup: true,
                        createdAt: new Date().toISOString()
                    }
                },
                'luciano_secreto': {
                    nombre: 'Luciano',
                    tipo: 'secreto',
                    data: {
                        id: "luciano_secreto",
                        name: "Luciano",
                        displayName: "Luciano",
                        username: "luciano_secreto",
                        type: "secreto",
                        category: "Jurado Secreto",
                        active: true,
                        canVote: true,
                        canComment: true,
                        accessReports: false,
                        secretVote: true,
                        confidential: true,
                        eventId: 'vIINfBwQaFsIhNOYWPtS',
                        backup: true,
                        createdAt: new Date().toISOString()
                    }
                }
            }
        };

        // Log de protecci√≥n
        function logProtection(message, type = 'info') {
            const logDiv = document.getElementById('protection-log');
            const timestamp = new Date().toLocaleTimeString();
            let className = 'text-white';
            
            switch(type) {
                case 'error': className = 'text-red-400'; break;
                case 'success': className = 'text-green-400'; break;
                case 'warning': className = 'text-yellow-400'; break;
                case 'critical': className = 'text-red-300 font-bold'; break;
            }
            
            logDiv.innerHTML += `<p class="${className}">[${timestamp}] ${message}</p>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Verificar jurados cr√≠ticos
        async function verificarJuradosCriticos() {
            try {
                const juradosSnapshot = await getDocs(collection(db, `events/${GALA1_CONFIG.eventId}/jury_users`));
                const juradosEncontrados = {};
                
                juradosSnapshot.forEach(doc => {
                    juradosEncontrados[doc.id] = doc.data();
                });

                // Verificar Eze y Ceci
                if (juradosEncontrados['eze_ceci_grupal']) {
                    document.getElementById('eze-ceci-status').innerHTML = '<span class="text-green-400">‚úÖ ACTIVO</span>';
                    logProtection('‚úÖ Eze y Ceci: PRESENTE y SEGURO', 'success');
                } else {
                    document.getElementById('eze-ceci-status').innerHTML = '<span class="text-red-400">‚ùå FALTANTE</span>';
                    logProtection('‚ùå Eze y Ceci: FALTANTE - CR√çTICO', 'critical');
                }

                // Verificar Luciano
                if (juradosEncontrados['luciano_secreto']) {
                    document.getElementById('luciano-status').innerHTML = '<span class="text-green-400">‚úÖ ACTIVO</span>';
                    logProtection('‚úÖ Luciano (secreto): PRESENTE y SEGURO', 'success');
                } else {
                    document.getElementById('luciano-status').innerHTML = '<span class="text-red-400">‚ùå FALTANTE</span>';
                    logProtection('‚ùå Luciano (secreto): FALTANTE - CR√çTICO', 'critical');
                }

                return juradosEncontrados;

            } catch (error) {
                logProtection(`‚ùå Error verificando jurados: ${error.message}`, 'error');
                return {};
            }
        }

        // Verificar votos reales
        async function verificarVotosReales() {
            let totalJuryVotes = 0;
            let totalPublicVotes = 0;

            try {
                // Votos de jurados
                const collections = ['jury_evaluations', 'jury_votes', 'votes'];
                for (const collectionName of collections) {
                    try {
                        const votesSnapshot = await getDocs(collection(db, `events/${GALA1_CONFIG.eventId}/${collectionName}`));
                        totalJuryVotes += votesSnapshot.size;
                    } catch (error) {
                        // Colecci√≥n no existe o no accesible
                    }
                }

                // Votos p√∫blicos
                const ticketVotesSnapshot = await getDocs(collection(db, `events/${GALA1_CONFIG.eventId}/ticket_votes`));
                for (const ticketDoc of ticketVotesSnapshot.docs) {
                    const votesSnapshot = await getDocs(collection(db, `events/${GALA1_CONFIG.eventId}/ticket_votes/${ticketDoc.id}/votes`));
                    totalPublicVotes += votesSnapshot.size;
                }

                // Artistas
                const artistsSnapshot = await getDocs(collection(db, `events/${GALA1_CONFIG.eventId}/artists`));

                // Actualizar UI
                document.getElementById('jury-votes').textContent = totalJuryVotes;
                document.getElementById('public-votes').textContent = totalPublicVotes;
                document.getElementById('total-artists').textContent = artistsSnapshot.size;

                if (totalJuryVotes > 0 || totalPublicVotes > 0) {
                    logProtection(`üõ°Ô∏è DATOS REALES CONFIRMADOS: ${totalJuryVotes} votos jurados, ${totalPublicVotes} votos p√∫blicos`, 'critical');
                } else {
                    logProtection('‚Ñπ No se detectaron votos (puede ser normal si no ha empezado la votaci√≥n)', 'info');
                }

                return { juryVotes: totalJuryVotes, publicVotes: totalPublicVotes, artists: artistsSnapshot.size };

            } catch (error) {
                logProtection(`‚ùå Error verificando votos: ${error.message}`, 'error');
                return { juryVotes: 0, publicVotes: 0, artists: 0 };
            }
        }

        // Funci√≥n principal de verificaci√≥n
        window.verificarTodo = async function() {
            logProtection('üîç INICIANDO VERIFICACI√ìN COMPLETA DE GALA 1...', 'critical');
            
            await verificarJuradosCriticos();
            await verificarVotosReales();
            
            logProtection('‚úÖ VERIFICACI√ìN COMPLETA FINALIZADA', 'success');
        };

        // Backup de emergencia
        window.backupEmergencia = async function() {
            logProtection('üíæ CREANDO BACKUP DE EMERGENCIA...', 'critical');
            
            try {
                const backupData = {
                    timestamp: new Date().toISOString(),
                    event: GALA1_CONFIG.eventName,
                    eventId: GALA1_CONFIG.eventId,
                    type: 'BACKUP_EMERGENCIA_GALA1',
                    data: {}
                };

                // Backup completo
                const collections = ['jury_users', 'artists', 'jury_evaluations', 'jury_votes', 'votes'];
                
                for (const collectionName of collections) {
                    try {
                        const snapshot = await getDocs(collection(db, `events/${GALA1_CONFIG.eventId}/${collectionName}`));
                        backupData.data[collectionName] = {};
                        snapshot.forEach(doc => {
                            backupData.data[collectionName][doc.id] = doc.data();
                        });
                        logProtection(`‚úì Respaldado ${collectionName}: ${snapshot.size} documentos`, 'success');
                    } catch (error) {
                        logProtection(`‚ö† No se pudo respaldar ${collectionName}`, 'warning');
                    }
                }

                // Descargar
                const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `BACKUP_EMERGENCIA_GALA1_${new Date().toISOString().split('T')[0]}.json`;
                a.click();

                logProtection('‚úÖ BACKUP DE EMERGENCIA CREADO', 'success');

            } catch (error) {
                logProtection(`‚ùå Error en backup: ${error.message}`, 'error');
            }
        };

        // Restaurar jurados cr√≠ticos
        window.restaurarJurados = async function() {
            if (!confirm('‚ö†Ô∏è ¬øConfirmas restaurar los jurados cr√≠ticos Eze y Ceci + Luciano?')) {
                return;
            }

            logProtection('‚ôªÔ∏è RESTAURANDO JURADOS CR√çTICOS...', 'critical');
            
            let exitosos = 0;

            for (const [id, config] of Object.entries(GALA1_CONFIG.jurados)) {
                try {
                    await setDoc(doc(db, `events/${GALA1_CONFIG.eventId}/jury_users`, id), config.data);
                    logProtection(`‚úÖ ${config.nombre} restaurado exitosamente`, 'success');
                    exitosos++;
                } catch (error) {
                    logProtection(`‚ùå Error restaurando ${config.nombre}: ${error.message}`, 'error');
                }
            }

            if (exitosos === 2) {
                logProtection('üéâ TODOS LOS JURADOS CR√çTICOS RESTAURADOS', 'success');
                alert('‚úÖ Jurados restaurados:\n\n- Eze y Ceci (Jurado Grupal)\n- Luciano (Jurado Secreto)\n\nYa pueden acceder al sistema de votaci√≥n.');
                
                // Re-verificar
                setTimeout(() => {
                    verificarJuradosCriticos();
                }, 1000);
            }
        };

        // Reporte de seguridad
        window.reporteSeguridad = function() {
            const report = `
üìä REPORTE DE SEGURIDAD - GALA 1 CON PUNTUACI√ìN

üÜî Event ID: ${GALA1_CONFIG.eventId}
üìÖ Fecha: ${new Date().toLocaleDateString()}
‚è∞ Hora: ${new Date().toLocaleTimeString()}

üë• JURADOS CR√çTICOS:
- Eze y Ceci (Jurado Grupal): ${document.getElementById('eze-ceci-status').textContent}
- Luciano (Jurado Secreto): ${document.getElementById('luciano-status').textContent}

üó≥Ô∏è DATOS REALES:
- Votos de Jurados: ${document.getElementById('jury-votes').textContent}
- Votos P√∫blicos: ${document.getElementById('public-votes').textContent}
- Total Artistas: ${document.getElementById('total-artists').textContent}

üõ°Ô∏è ESTADO: GALA 1 CONTIENE DATOS REALES - PROTEGIDA
‚ö†Ô∏è ADVERTENCIA: NO usar funciones de datos de ejemplo en esta gala

üìã Archivos de backup disponibles:
- BACKUP_JURADOS_SEGUROS.json
- restaurar_jurados_seguros.html
- INSTRUCCIONES_JURADOS_SEGUROS.md
            `;

            alert(report);
            console.log(report);
        };

        // Inicializaci√≥n autom√°tica
        document.addEventListener('DOMContentLoaded', function() {
            logProtection('üöÄ SISTEMA DE PROTECCI√ìN GALA 1 INICIADO', 'critical');
            logProtection(`üìã Protegiendo: ${GALA1_CONFIG.eventName}`, 'info');
            
            // Verificaci√≥n autom√°tica cada 30 segundos
            verificarTodo();
            setInterval(() => {
                verificarTodo();
            }, 30000);
        });
    </script>
</body>
</html>