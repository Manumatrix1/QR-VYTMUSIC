<!DOCTYPE html>
<html lang="es">
<head>
    </head>
<body class="antialiased">
    <script type="module">
        import { db } from './firebase_config.js';
        import { collection, query, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ... (Lógica inicial sin cambios) ...

        async function loadArtistsWithTickets() {
            // ... (código inicial de la función sin cambios) ...
            
            const ticketsQuery = query(collection(db, `events/${eventId}/tickets`));
            const querySnapshot = await getDocs(ticketsQuery);
            const tickets = querySnapshot.docs.map(doc => doc.data());

            if (tickets.length === 0) { /* ... sin cambios ... */ }

            // Creamos un mapa para contar las entradas por prefijo
            const prefixCounts = tickets.reduce((acc, ticket) => {
                acc[ticket.prefix] = (acc[ticket.prefix] || 0) + 1;
                return acc;
            }, {});

            const artistPrefixes = Object.keys(prefixCounts).sort();
            
            artistsListDiv.innerHTML = '';

            artistPrefixes.forEach(prefix => {
                const count = prefixCounts[prefix];
                const link = document.createElement('a');
                link.href = `visor_qr_compartido.html?eventId=${eventId}&artist=${encodeURIComponent(prefix)}`;
                link.className = 'artist-card';
                // AÑADIMOS EL CONTADOR DE ENTRADAS
                link.innerHTML = `
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold text-sky-400">${prefix}</h3>
                        <span class="text-md text-gray-400 font-semibold">${count} entrada(s)</span>
                    </div>
                `;
                artistsListDiv.appendChild(link);
            });
        }

        loadArtistsWithTickets();
    </script>
</body>
</html>