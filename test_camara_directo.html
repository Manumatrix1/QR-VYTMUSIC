<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ TEST CÃMARA DIRECTO - NO PWA</title>
    
    <!-- ANTI-CACHE HEADERS -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- NO MANIFEST = NO PWA -->
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #1e293b; color: white; font-family: Arial, sans-serif; }
        .test-container { max-width: 400px; margin: 20px auto; padding: 20px; background: #334155; border-radius: 15px; }
        .test-button { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 10px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .success { background: #10b981; color: white; }
        .error { background: #ef4444; color: white; }
        .warning { background: #f59e0b; color: white; }
        .info { background: #3b82f6; color: white; }
        #video-preview { width: 100%; max-width: 300px; height: 200px; background: #000; border-radius: 10px; margin: 10px 0; }
        .result-box { padding: 15px; margin: 10px 0; border-radius: 10px; background: #475569; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 style="text-align: center; margin-bottom: 20px;">ğŸ”§ TEST DIRECTO DE CÃMARA</h1>
        <p style="text-align: center; font-size: 14px; color: #94a3b8; margin-bottom: 30px;">
            Esta pÃ¡gina NO es PWA - Test puro de navegador
        </p>
        
        <!-- InformaciÃ³n del sistema -->
        <div class="result-box">
            <h3>ğŸ“Š InformaciÃ³n del Sistema</h3>
            <div id="system-info"></div>
        </div>
        
        <!-- Tests paso a paso -->
        <div class="result-box">
            <h3>ğŸ§ª Tests de Funcionalidad</h3>
            
            <button class="test-button info" onclick="testBasics()">
                ğŸ” 1. Test BÃ¡sico del Navegador
            </button>
            
            <button class="test-button info" onclick="testPermissions()">
                ğŸ” 2. Test de Permisos
            </button>
            
            <button class="test-button info" onclick="testCameraAccess()">
                ğŸ“· 3. Test de Acceso a CÃ¡mara
            </button>
            
            <button class="test-button info" onclick="testCameraPreview()">
                ğŸ¥ 4. Test de Vista Previa
            </button>
            
            <div id="test-results"></div>
        </div>
        
        <!-- Vista previa de cÃ¡mara -->
        <div class="result-box">
            <h3>ğŸ“¹ Vista Previa</h3>
            <video id="video-preview" autoplay muted playsinline></video>
            <button class="test-button error" onclick="stopCamera()" style="display: none;" id="stop-btn">
                âŒ Detener CÃ¡mara
            </button>
        </div>
        
        <!-- DiagnÃ³stico detallado -->
        <div class="result-box">
            <h3>ğŸ”¬ DiagnÃ³stico Detallado</h3>
            <div id="detailed-diagnosis"></div>
        </div>
        
        <!-- Links de vuelta -->
        <div style="text-align: center; margin-top: 30px;">
            <a href="/escaner_inteligente_integrado.html" style="color: #3b82f6; text-decoration: none;">
                â† Volver al EscÃ¡ner Principal
            </a>
        </div>
    </div>

    <script>
        let currentStream = null;
        
        // InformaciÃ³n del sistema al cargar
        window.onload = function() {
            showSystemInfo();
            log('ğŸš€ Test directo iniciado - NO PWA mode', 'info');
        };
        
        function showSystemInfo() {
            const info = document.getElementById('system-info');
            info.innerHTML = `
                <p><strong>ğŸŒ User Agent:</strong> ${navigator.userAgent}</p>
                <p><strong>ğŸ“± Plataforma:</strong> ${navigator.platform}</p>
                <p><strong>ğŸ”’ Protocolo:</strong> ${location.protocol}</p>
                <p><strong>ğŸ  Host:</strong> ${location.host}</p>
                <p><strong>ğŸ“„ URL:</strong> ${location.href}</p>
                <p><strong>ğŸ¯ PWA Mode:</strong> ${(window.matchMedia('(display-mode: standalone)').matches) ? 'SÃ' : 'NO'}</p>
                <p><strong>ğŸ“¦ Service Worker:</strong> ${'serviceWorker' in navigator ? 'Disponible' : 'No disponible'}</p>
            `;
        }
        
        function log(message, type = 'info') {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.style.padding = '10px';
            div.style.margin = '5px 0';
            div.style.borderRadius = '5px';
            div.style.fontSize = '14px';
            
            switch(type) {
                case 'success': div.style.background = '#10b981'; break;
                case 'error': div.style.background = '#ef4444'; break;
                case 'warning': div.style.background = '#f59e0b'; break;
                default: div.style.background = '#475569'; break;
            }
            
            div.innerHTML = message;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }
        
        async function testBasics() {
            log('ğŸ” Iniciando test bÃ¡sico...', 'info');
            
            // Test 1: MediaDevices API
            if (!navigator.mediaDevices) {
                log('âŒ navigator.mediaDevices NO disponible', 'error');
                return false;
            }
            log('âœ… navigator.mediaDevices disponible', 'success');
            
            // Test 2: getUserMedia
            if (!navigator.mediaDevices.getUserMedia) {
                log('âŒ getUserMedia NO disponible', 'error');
                return false;
            }
            log('âœ… getUserMedia disponible', 'success');
            
            // Test 3: HTTPS
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                log('âš ï¸ Protocolo inseguro: ' + location.protocol, 'warning');
            } else {
                log('âœ… Protocolo seguro: ' + location.protocol, 'success');
            }
            
            return true;
        }
        
        async function testPermissions() {
            log('ğŸ” Probando permisos...', 'info');
            
            if (!navigator.permissions) {
                log('âš ï¸ Permissions API no disponible', 'warning');
                return;
            }
            
            try {
                const permission = await navigator.permissions.query({name: 'camera'});
                log(`ğŸ“‹ Estado de permisos: ${permission.state}`, permission.state === 'granted' ? 'success' : 'warning');
                
                permission.onchange = () => {
                    log(`ğŸ”„ Permiso cambiÃ³ a: ${permission.state}`, permission.state === 'granted' ? 'success' : 'warning');
                };
            } catch (error) {
                log(`âŒ Error consultando permisos: ${error.message}`, 'error');
            }
        }
        
        async function testCameraAccess() {
            log('ğŸ“· Probando acceso a cÃ¡mara...', 'info');
            
            try {
                // Detener stream anterior si existe
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                }
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                log('âœ… Â¡Acceso a cÃ¡mara EXITOSO!', 'success');
                log(`ğŸ“Š Stream tracks: ${stream.getTracks().length}`, 'info');
                
                stream.getTracks().forEach((track, index) => {
                    log(`ğŸ“¹ Track ${index + 1}: ${track.kind} - ${track.label}`, 'info');
                });
                
                // Detener para no interferir
                stream.getTracks().forEach(track => track.stop());
                
                return true;
            } catch (error) {
                log(`âŒ Error de cÃ¡mara: ${error.name} - ${error.message}`, 'error');
                detailedDiagnosis(error);
                return false;
            }
        }
        
        async function testCameraPreview() {
            log('ğŸ¥ Iniciando vista previa...', 'info');
            
            try {
                const video = document.getElementById('video-preview');
                const stopBtn = document.getElementById('stop-btn');
                
                currentStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                
                video.srcObject = currentStream;
                stopBtn.style.display = 'block';
                
                log('âœ… Vista previa iniciada correctamente', 'success');
                
            } catch (error) {
                log(`âŒ Error en vista previa: ${error.message}`, 'error');
                detailedDiagnosis(error);
            }
        }
        
        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                document.getElementById('video-preview').srcObject = null;
                document.getElementById('stop-btn').style.display = 'none';
                log('ğŸ›‘ CÃ¡mara detenida', 'info');
            }
        }
        
        function detailedDiagnosis(error) {
            const diagnosis = document.getElementById('detailed-diagnosis');
            diagnosis.innerHTML = `
                <h4 style="color: #ef4444; margin-bottom: 10px;">âŒ Error Detectado</h4>
                <p><strong>Nombre:</strong> ${error.name}</p>
                <p><strong>Mensaje:</strong> ${error.message}</p>
                <p><strong>Tipo:</strong> ${typeof error}</p>
                
                <h4 style="color: #f59e0b; margin: 15px 0 10px 0;">ğŸ’¡ Posibles Soluciones:</h4>
                <ul style="margin-left: 20px;">
                    ${error.name === 'NotAllowedError' ? '<li>Permite acceso a la cÃ¡mara en configuraciÃ³n del navegador</li>' : ''}
                    ${error.name === 'NotFoundError' ? '<li>No se encontrÃ³ cÃ¡mara disponible</li>' : ''}
                    ${error.name === 'NotReadableError' ? '<li>CÃ¡mara en uso por otra aplicaciÃ³n</li>' : ''}
                    ${error.name === 'OverconstrainedError' ? '<li>ConfiguraciÃ³n de cÃ¡mara no soportada</li>' : ''}
                    <li>Reinicia el navegador</li>
                    <li>Prueba en modo incÃ³gnito</li>
                    <li>Verifica permisos de la aplicaciÃ³n en configuraciÃ³n del telÃ©fono</li>
                </ul>
            `;
        }
    </script>
</body>
</html>f o r c e   u p d a t e 
 
 