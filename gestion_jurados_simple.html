<!DOCTYPE html><!DOCTYPE html>

<html lang="es"><html lang="es">

<head><head>

    <meta charset="UTF-8">    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>GestiÃ³n de Jurados - VYT Music</title>    <title>GestiÃ³n de Jurados - VYTMUSIC</title>

    <script src="https://cdn.tailwindcss.com"></script>    <script src="https://cdn.tailwindcss.com"></script>

</head></head>

<body class="bg-gray-900 text-white min-h-screen"><body class="bg-gray-900 text-white min-h-screen">

    <div class="container mx-auto px-4 py-8 max-w-4xl">    

        <!-- Header -->    <div class="container mx-auto max-w-6xl p-4 sm:p-6">

        <div class="text-center mb-8">        <header class="text-center mb-6">

            <h1 class="text-4xl font-bold mb-2">ğŸ­ GestiÃ³n de Jurados</h1>            <h1 class="text-3xl sm:text-4xl font-bold text-sky-400">GestiÃ³n de Jurados</h1>

            <p id="event-title" class="text-xl text-gray-300">Cargando evento...</p>            <p class="text-xl text-gray-300 mt-2">Administrar jurados del certamen</p>

            <a href="#" id="back-link" class="inline-block mt-4 px-4 py-2 bg-gray-600 rounded hover:bg-gray-700">        </header>

                â† Volver al Panel

            </a>        <main class="space-y-8">

        </div>            <!-- EstadÃ­sticas -->

            <section class="bg-gray-800 p-6 rounded-lg shadow-xl">

        <!-- Crear Nuevo Jurado -->                <h2 class="text-2xl font-bold mb-4">ğŸ“Š EstadÃ­sticas</h2>

        <div class="bg-gray-800 rounded-lg p-6 mb-8">                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">

            <h2 class="text-2xl font-bold mb-4">â• Crear Nuevo Jurado</h2>                    <div class="bg-sky-600 p-4 rounded-lg text-center">

            <form id="jury-form" class="space-y-4">                        <div class="text-2xl font-bold" id="total-jurors">0</div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">                        <div class="text-sm opacity-80">Total Jurados</div>

                    <div>                    </div>

                        <label class="block mb-2 font-semibold">ğŸ‘¤ Nombre del Jurado</label>                    <div class="bg-green-600 p-4 rounded-lg text-center">

                        <input type="text" id="jury-name" required                         <div class="text-2xl font-bold">âœ“</div>

                               class="w-full p-3 rounded bg-gray-700 border border-gray-600 text-white focus:border-blue-500">                        <div class="text-sm opacity-80">Sistema Activo</div>

                    </div>                    </div>

                    <div>                    <div class="bg-blue-600 p-4 rounded-lg text-center">

                        <label class="block mb-2 font-semibold">ğŸ” ContraseÃ±a</label>                        <div class="text-2xl font-bold">ğŸ­</div>

                        <input type="password" id="jury-password" required                         <div class="text-sm opacity-80">GestiÃ³n Local</div>

                               class="w-full p-3 rounded bg-gray-700 border border-gray-600 text-white focus:border-blue-500">                    </div>

                    </div>                </div>

                </div>            </section>

                <div>

                    <label class="block mb-2 font-semibold">ğŸ¯ Tipo de Jurado</label>            <!-- Lista de Jurados -->

                    <select id="jury-type" required             <section class="bg-gray-800 p-6 rounded-lg shadow-xl">

                            class="w-full p-3 rounded bg-gray-700 border border-gray-600 text-white">                <div class="flex justify-between items-center mb-4">

                        <option value="individual">ğŸ§‘ Individual</option>                    <h2 class="text-2xl font-bold">ğŸ‘¥ Jurados Registrados</h2>

                        <option value="grupal">ğŸ‘¥ Grupal</option>                    <button onclick="agregarJurado()" class="px-4 py-2 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700">

                        <option value="secreto">ğŸ¤ Secreto</option>                        â• Agregar Jurado

                    </select>                    </button>

                </div>                </div>

                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded font-bold">                

                    âœ… Crear Jurado                <div id="jurors-list" class="space-y-4">

                </button>                    <p class="text-center text-gray-400">Cargando jurados...</p>

            </form>                </div>

        </div>            </section>

        </main>

        <!-- Lista de Jurados -->    </div>

        <div class="bg-gray-800 rounded-lg p-6 mb-8">

            <h2 class="text-2xl font-bold mb-4">ğŸ“‹ Jurados Registrados</h2>    <script>

            <div id="loading" class="text-center py-8">        // VERSIÃ“N SÃšPER SIMPLE - CON PERSISTENCIA REAL

                <p>Cargando jurados...</p>        

            </div>        // Obtener parÃ¡metros de URL

            <div id="jury-list" class="space-y-4"></div>        const urlParams = new URLSearchParams(window.location.search);

        </div>        const eventId = urlParams.get('eventId') || 'demo';

        

        <!-- Acceso RÃ¡pido -->        let jurados = [];

        <div class="bg-gray-800 rounded-lg p-6">

            <h2 class="text-2xl font-bold mb-4">ğŸš€ Acceso RÃ¡pido</h2>        // Cargar jurados desde localStorage

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">        function cargarJurados() {

                <button id="test-voting-btn" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded font-bold">            const eventKey = `jurors_${eventId}`;

                    ğŸ§ª Probar Sistema de VotaciÃ³n            const storedJurors = localStorage.getItem(eventKey);

                </button>            

                <button id="view-results-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded font-bold">            if (storedJurors) {

                    ğŸ“Š Ver Resultados Actuales                try {

                </button>                    jurados = JSON.parse(storedJurors);

            </div>                    console.log('âœ… Jurados cargados desde localStorage:', jurados.length);

        </div>                } catch (error) {

    </div>                    console.error('Error parseando jurados:', error);

                    jurados = [];

    <script type="module">                }

        import { db } from './firebase_config.js';            } else {

        import { collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";                jurados = [];

                console.log('ğŸ“ No hay jurados guardados - iniciando con lista vacÃ­a');

        // Obtener parÃ¡metros de URL            }

        const urlParams = new URLSearchParams(window.location.search);        }

        const eventId = urlParams.get('eventId');

        const eventName = urlParams.get('eventName');        // Guardar jurados en localStorage

        function guardarJurados() {

        if (!eventId || !eventName) {            const eventKey = `jurors_${eventId}`;

            alert('Error: No se especificÃ³ un evento vÃ¡lido.');            localStorage.setItem(eventKey, JSON.stringify(jurados));

            window.location.href = 'eventos.html';            console.log('ğŸ’¾ Jurados guardados en localStorage');

        }        }



        // Configurar UI inicial        // Crear jurados de ejemplo (solo manualmente)

        document.getElementById('event-title').textContent = eventName;        function crearJuradosEjemplo() {

        document.getElementById('back-link').href = `panel_evento.html?eventId=${eventId}&eventName=${encodeURIComponent(eventName)}`;            if (jurados.length > 0) {

                if (!confirm('Â¿Reemplazar jurados existentes con ejemplos?')) {

        let currentJuries = [];                    return;

                }

        // Cargar jurados al iniciar            }

        loadJuries();            

            jurados = [

        // Form para crear jurado                {

        document.getElementById('jury-form').addEventListener('submit', async (e) => {                    id: 'jurado1',

            e.preventDefault();                    name: 'luciano',

                                password: 'ABC123',

            const name = document.getElementById('jury-name').value.trim();                    isSecret: false,

            const password = document.getElementById('jury-password').value;                    active: true,

            const type = document.getElementById('jury-type').value;                    createdAt: new Date().toISOString()

                },

            if (!name || !password) {                {

                alert('âŒ Nombre y contraseÃ±a son obligatorios');                    id: 'jurado2', 

                return;                    name: 'machito',

            }                    password: 'DEF456',

                    isSecret: false,

            // Verificar si el nombre ya existe                    active: true,

            if (currentJuries.some(jury => jury.username.toLowerCase() === name.toLowerCase())) {                    createdAt: new Date().toISOString()

                alert('âŒ Ya existe un jurado con ese nombre');                },

                return;                {

            }                    id: 'jurado3',

                    name: 'manu', 

            try {                    password: 'GHI789',

                const juryData = {                    isSecret: true,

                    username: name.toLowerCase(),                    active: true,

                    displayName: name,                    createdAt: new Date().toISOString()

                    password: password,                }

                    type: type,            ];

                    active: true,            guardarJurados();

                    createdAt: new Date(),            renderizarJurados();

                    votedArtists: []            console.log('âœ… Jurados de ejemplo creados');

                };        }



                await addDoc(collection(db, `events/${eventId}/juries`), juryData);        function renderizarJurados() {

                            const lista = document.getElementById('jurors-list');

                alert(`âœ… Jurado "${name}" creado exitosamente`);            const total = document.getElementById('total-jurors');

                document.getElementById('jury-form').reset();            

                loadJuries();            console.log('ğŸ­ Renderizando', jurados.length, 'jurados');

            

            } catch (error) {            if (jurados.length === 0) {

                console.error('Error creando jurado:', error);                lista.innerHTML = '<p class="text-center text-gray-400">No hay jurados registrados</p>';

                alert('âŒ Error al crear jurado: ' + error.message);                total.textContent = '0';

            }                return;

        });            }



        // Cargar lista de jurados            lista.innerHTML = jurados.map(jurado => `

        async function loadJuries() {                <div class="bg-gray-700 p-4 rounded-lg shadow-md border border-gray-600" id="card-${jurado.id}">

            const loading = document.getElementById('loading');                    <div class="flex justify-between items-center">

            const juryList = document.getElementById('jury-list');                        <div>

                                        <h3 class="text-lg font-semibold text-white">ğŸ‘¤ ${jurado.username}</h3>

            loading.style.display = 'block';                            <p class="text-sm text-gray-300">ğŸ” Password: ${jurado.password}</p>

            juryList.innerHTML = '';                            <div class="flex gap-2 mt-2">

                                ${jurado.isSecret ? 

            try {                                    '<span class="px-2 py-1 bg-yellow-600 text-xs rounded">ğŸ¤« Secreto</span>' : 

                const juriesSnapshot = await getDocs(query(collection(db, `events/${eventId}/juries`), orderBy('createdAt', 'desc')));                                    '<span class="px-2 py-1 bg-green-600 text-xs rounded">ğŸ‘ï¸ PÃºblico</span>'

                currentJuries = juriesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));                                }

                                <span class="px-2 py-1 bg-gray-600 text-xs rounded">ğŸ“… ${new Date(jurado.createdAt).toLocaleDateString()}</span>

                loading.style.display = 'none';                            </div>

                        </div>

                if (currentJuries.length === 0) {                        <div class="flex gap-2">

                    juryList.innerHTML = `                            <button onclick="editarJurado('${jurado.id}')" 

                        <div class="text-center py-8">                                    class="px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">

                            <p class="text-xl text-gray-400">ğŸ“­ No hay jurados registrados</p>                                âœï¸ Editar

                            <p class="text-gray-500">Crea el primer jurado usando el formulario de arriba</p>                            </button>

                        </div>                            <button onclick="eliminarJuradoDirecto('${jurado.id}')" 

                    `;                                    class="px-3 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700">

                    return;                                ğŸ—‘ï¸ Eliminar

                }                            </button>

                        </div>

                currentJuries.forEach(jury => {                    </div>

                    const juryCard = document.createElement('div');                </div>

                    juryCard.className = 'bg-gray-700 rounded-lg p-4 flex justify-between items-center';            `).join('');

                                

                    const typeIcon = {            total.textContent = jurados.length;

                        'individual': 'ğŸ§‘',            console.log('âœ… Renderizado completado');

                        'grupal': 'ğŸ‘¥',        }

                        'secreto': 'ğŸ¤'        

                    }[jury.type] || 'ğŸ­';        function eliminarJuradoDirecto(id) {

            console.log('ğŸ—‘ï¸ ELIMINANDO JURADO DIRECTO:', id);

                    const statusBadge = jury.active             

                        ? '<span class="px-2 py-1 bg-green-500 text-white text-xs rounded">Activo</span>'            // Confirmar con el usuario

                        : '<span class="px-2 py-1 bg-red-500 text-white text-xs rounded">Inactivo</span>';            if (!confirm(`Â¿Eliminar el jurado ${id}?`)) {

                console.log('âŒ EliminaciÃ³n cancelada por el usuario');

                    juryCard.innerHTML = `                return;

                        <div class="flex-1">            }

                            <div class="flex items-center space-x-3">            

                                <span class="text-2xl">${typeIcon}</span>            // Encontrar el jurado

                                <div>            const jurado = jurados.find(j => j.id === id);

                                    <h3 class="font-bold text-lg">${jury.displayName}</h3>            if (!jurado) {

                                    <p class="text-sm text-gray-300">Usuario: ${jury.username}</p>                alert('âŒ Jurado no encontrado');

                                    <p class="text-sm text-gray-400">Tipo: ${jury.type}</p>                return;

                                </div>            }

                            </div>            

                        </div>            // Eliminar del array

                        <div class="flex items-center space-x-3">            jurados = jurados.filter(j => j.id !== id);

                            ${statusBadge}            

                            <button onclick="deleteJury('${jury.id}', '${jury.displayName}')"             // Guardar cambios en localStorage

                                    class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">            guardarJurados();

                                ğŸ—‘ï¸ Eliminar            

                            </button>            // Re-renderizar

                        </div>            renderizarJurados();

                    `;            

                                // Mostrar confirmaciÃ³n

                    juryList.appendChild(juryCard);            alert(`âœ… Jurado "${jurado.name || jurado.username}" eliminado correctamente!`);

                });            

            console.log('âœ… EliminaciÃ³n completada. Jurados restantes:', jurados.length);

            } catch (error) {        }

                console.error('Error cargando jurados:', error);        

                loading.style.display = 'none';        function editarJurado(id) {

                juryList.innerHTML = `            alert(`âœï¸ FunciÃ³n de editar jurado ${id} - Por implementar`);

                    <div class="text-center py-8 text-red-400">        }

                        <p class="text-xl">âŒ Error al cargar jurados</p>        

                        <p class="text-gray-400">${error.message}</p>        function agregarJurado() {

                        <button onclick="loadJuries()" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">            // Solicitar datos al usuario

                            ğŸ”„ Reintentar            const username = prompt("Nombre del jurado:");

                        </button>            if (!username || username.trim() === '') {

                    </div>                alert("âŒ Nombre es requerido");

                `;                return;

            }            }

        }            

            const password = prompt("ContraseÃ±a del jurado:") || 'temp' + Math.floor(Math.random() * 1000);

        // FunciÃ³n global para eliminar jurado            const esSecreto = confirm("Â¿Es un jurado secreto?");

        window.deleteJury = async (juryId, juryName) => {            

            if (confirm(`Â¿EstÃ¡s seguro de eliminar al jurado "${juryName}"?`)) {            const nuevoId = 'jurado_' + Date.now();

                try {            const nuevoJurado = {

                    await deleteDoc(doc(db, `events/${eventId}/juries`, juryId));                id: nuevoId,

                    loadJuries();                username: username.trim(),

                } catch (error) {                password: password,

                    alert('âŒ Error al eliminar: ' + error.message);                isSecret: esSecreto,

                }                createdAt: new Date().toISOString()

            }            };

        };            

            jurados.push(nuevoJurado);

        // FunciÃ³n global para recargar            

        window.loadJuries = loadJuries;            // Guardar en localStorage

            guardarJurados();

        // Botones de acceso rÃ¡pido            

        document.getElementById('test-voting-btn').addEventListener('click', () => {            renderizarJurados();

            const testUrl = `votacion_jurados_FINAL.html?eventId=${eventId}&eventName=${encodeURIComponent(eventName)}`;            

            window.open(testUrl, '_blank');            alert(`âœ… Jurado "${nuevoJurado.username}" agregado correctamente!`);

        });        }



        document.getElementById('view-results-btn').addEventListener('click', () => {        // INICIALIZAR CON PERSISTENCIA

            const resultsUrl = `resultados_votacion.html?eventId=${eventId}`;        console.log('ğŸš€ Iniciando sistema simple...');

            window.open(resultsUrl, '_blank');        cargarJurados(); // Cargar desde localStorage

        });        renderizarJurados();

    </script>        console.log('âœ… Sistema simple iniciado con', jurados.length, 'jurados');

</body>        

</html>        // Agregar botÃ³n para crear ejemplos si no hay jurados
        if (jurados.length === 0) {
            console.log('ğŸ“ No hay jurados - agregando opciÃ³n para crear ejemplos');
            setTimeout(() => {
                if (confirm('No hay jurados registrados. Â¿Crear jurados de ejemplo para probar?')) {
                    crearJuradosEjemplo();
                }
            }, 1000);
        }
        
        // Verificar que las funciones estÃ¡n disponibles
        console.log('ğŸ” Verificando funciones:');
        console.log('eliminarJuradoDirecto:', typeof eliminarJuradoDirecto);
        console.log('editarJurado:', typeof editarJurado);
        console.log('agregarJuradoDemo:', typeof agregarJuradoDemo);
    </script>
</body>
</html>