<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Jurados - VYTMUSIC</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    
    <div class="container mx-auto max-w-6xl p-4 sm:p-6">
        <header class="text-center mb-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-sky-400">Gestión de Jurados</h1>
            <p class="text-xl text-gray-300 mt-2">Administrar jurados del certamen</p>
        </header>

        <main class="space-y-8">
            <!-- Estadísticas -->
            <section class="bg-gray-800 p-6 rounded-lg shadow-xl">
                <h2 class="text-2xl font-bold mb-4">📊 Estadísticas</h2>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div class="bg-sky-600 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold" id="total-jurors">0</div>
                        <div class="text-sm opacity-80">Total Jurados</div>
                    </div>
                    <div class="bg-green-600 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold">✓</div>
                        <div class="text-sm opacity-80">Sistema Activo</div>
                    </div>
                    <div class="bg-blue-600 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold">🎭</div>
                        <div class="text-sm opacity-80">Gestión Local</div>
                    </div>
                </div>
            </section>

            <!-- Lista de Jurados -->
            <section class="bg-gray-800 p-6 rounded-lg shadow-xl">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">👥 Jurados Registrados</h2>
                    <button onclick="agregarJurado()" class="px-4 py-2 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700">
                        ➕ Agregar Jurado
                    </button>
                </div>
                
                <div id="jurors-list" class="space-y-4">
                    <p class="text-center text-gray-400">Cargando jurados...</p>
                </div>
            </section>
        </main>
    </div>

    <script>
        // VERSIÓN SÚPER SIMPLE - CON PERSISTENCIA REAL
        
        // Obtener parámetros de URL
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('eventId') || 'demo';
        
        let jurados = [];

        // Cargar jurados desde localStorage
        function cargarJurados() {
            const eventKey = `jurors_${eventId}`;
            const storedJurors = localStorage.getItem(eventKey);
            
            if (storedJurors) {
                try {
                    jurados = JSON.parse(storedJurors);
                    console.log('✅ Jurados cargados desde localStorage:', jurados.length);
                } catch (error) {
                    console.error('Error parseando jurados:', error);
                    jurados = [];
                }
            } else {
                jurados = [];
                console.log('📝 No hay jurados guardados - iniciando con lista vacía');
            }
        }

        // Guardar jurados en localStorage
        function guardarJurados() {
            const eventKey = `jurors_${eventId}`;
            localStorage.setItem(eventKey, JSON.stringify(jurados));
            console.log('💾 Jurados guardados en localStorage');
        }

        // Crear jurados de ejemplo (solo manualmente)
        function crearJuradosEjemplo() {
            if (jurados.length > 0) {
                if (!confirm('¿Reemplazar jurados existentes con ejemplos?')) {
                    return;
                }
            }
            
            jurados = [
                {
                    id: 'jurado1',
                    name: 'luciano',
                    password: 'ABC123',
                    isSecret: false,
                    active: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'jurado2', 
                    name: 'machito',
                    password: 'DEF456',
                    isSecret: false,
                    active: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'jurado3',
                    name: 'manu', 
                    password: 'GHI789',
                    isSecret: true,
                    active: true,
                    createdAt: new Date().toISOString()
                }
            ];
            guardarJurados();
            renderizarJurados();
            console.log('✅ Jurados de ejemplo creados');
        }

        function renderizarJurados() {
            const lista = document.getElementById('jurors-list');
            const total = document.getElementById('total-jurors');
            
            console.log('🎭 Renderizando', jurados.length, 'jurados');
            
            if (jurados.length === 0) {
                lista.innerHTML = '<p class="text-center text-gray-400">No hay jurados registrados</p>';
                total.textContent = '0';
                return;
            }

            lista.innerHTML = jurados.map(jurado => `
                <div class="bg-gray-700 p-4 rounded-lg shadow-md border border-gray-600" id="card-${jurado.id}">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-semibold text-white">👤 ${jurado.username}</h3>
                            <p class="text-sm text-gray-300">🔐 Password: ${jurado.password}</p>
                            <div class="flex gap-2 mt-2">
                                ${jurado.isSecret ? 
                                    '<span class="px-2 py-1 bg-yellow-600 text-xs rounded">🤫 Secreto</span>' : 
                                    '<span class="px-2 py-1 bg-green-600 text-xs rounded">👁️ Público</span>'
                                }
                                <span class="px-2 py-1 bg-gray-600 text-xs rounded">📅 ${new Date(jurado.createdAt).toLocaleDateString()}</span>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editarJurado('${jurado.id}')" 
                                    class="px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">
                                ✏️ Editar
                            </button>
                            <button onclick="eliminarJuradoDirecto('${jurado.id}')" 
                                    class="px-3 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700">
                                🗑️ Eliminar
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            total.textContent = jurados.length;
            console.log('✅ Renderizado completado');
        }
        
        function eliminarJuradoDirecto(id) {
            console.log('🗑️ ELIMINANDO JURADO DIRECTO:', id);
            
            // Confirmar con el usuario
            if (!confirm(`¿Eliminar el jurado ${id}?`)) {
                console.log('❌ Eliminación cancelada por el usuario');
                return;
            }
            
            // Encontrar el jurado
            const jurado = jurados.find(j => j.id === id);
            if (!jurado) {
                alert('❌ Jurado no encontrado');
                return;
            }
            
            // Eliminar del array
            jurados = jurados.filter(j => j.id !== id);
            
            // Guardar cambios en localStorage
            guardarJurados();
            
            // Re-renderizar
            renderizarJurados();
            
            // Mostrar confirmación
            alert(`✅ Jurado "${jurado.name || jurado.username}" eliminado correctamente!`);
            
            console.log('✅ Eliminación completada. Jurados restantes:', jurados.length);
        }
        
        function editarJurado(id) {
            alert(`✏️ Función de editar jurado ${id} - Por implementar`);
        }
        
        function agregarJurado() {
            // Solicitar datos al usuario
            const username = prompt("Nombre del jurado:");
            if (!username || username.trim() === '') {
                alert("❌ Nombre es requerido");
                return;
            }
            
            const password = prompt("Contraseña del jurado:") || 'temp' + Math.floor(Math.random() * 1000);
            const esSecreto = confirm("¿Es un jurado secreto?");
            
            const nuevoId = 'jurado_' + Date.now();
            const nuevoJurado = {
                id: nuevoId,
                username: username.trim(),
                password: password,
                isSecret: esSecreto,
                createdAt: new Date().toISOString()
            };
            
            jurados.push(nuevoJurado);
            
            // Guardar en localStorage
            guardarJurados();
            
            renderizarJurados();
            
            alert(`✅ Jurado "${nuevoJurado.username}" agregado correctamente!`);
        }

        // INICIALIZAR CON PERSISTENCIA
        console.log('🚀 Iniciando sistema simple...');
        cargarJurados(); // Cargar desde localStorage
        renderizarJurados();
        console.log('✅ Sistema simple iniciado con', jurados.length, 'jurados');
        
        // Agregar botón para crear ejemplos si no hay jurados
        if (jurados.length === 0) {
            console.log('📝 No hay jurados - agregando opción para crear ejemplos');
            setTimeout(() => {
                if (confirm('No hay jurados registrados. ¿Crear jurados de ejemplo para probar?')) {
                    crearJuradosEjemplo();
                }
            }, 1000);
        }
        
        // Verificar que las funciones están disponibles
        console.log('🔍 Verificando funciones:');
        console.log('eliminarJuradoDirecto:', typeof eliminarJuradoDirecto);
        console.log('editarJurado:', typeof editarJurado);
        console.log('agregarJuradoDemo:', typeof agregarJuradoDemo);
    </script>
</body>
</html>