<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VYT-MUSIC - Acceso Directo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%); }
        .card { background: rgba(31, 41, 55, 0.9); backdrop-filter: blur(10px); }
        .btn { transition: all 0.3s ease; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="card max-w-2xl w-full rounded-2xl shadow-2xl p-8">
        <div class="text-center mb-8">
            <div class="w-24 h-24 mx-auto mb-4">
                <img src="imagenes/logo-movimiento.png" alt="VYT-MUSIC" class="w-full h-full object-contain rounded-lg shadow-lg">
            </div>
            <h1 class="text-4xl font-bold text-sky-400 mb-2">VYT-MUSIC</h1>
            <p class="text-gray-300 text-lg" id="event-title">Cargando evento activo...</p>
        </div>

        <div id="loading-section" class="text-center py-8">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-sky-400"></div>
            <p class="text-gray-400 mt-4">Detectando evento activo...</p>
        </div>

        <div id="content-section" class="hidden space-y-4">
            <!-- ESC√ÅNER PARA ASISTENTES -->
            <a href="escaner_inteligente_integrado.html" 
               class="btn block w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-6 px-8 rounded-xl text-center shadow-lg">
                <div class="text-3xl mb-2">üì±</div>
                <div class="text-xl">Esc√°ner de Entradas</div>
                <div class="text-sm opacity-90 mt-1">Para asistentes que controlan el ingreso</div>
            </a>

            <!-- VOTACI√ìN DE JURADOS -->
            <a href="resultados_jurados.html" 
               class="btn block w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-6 px-8 rounded-xl text-center shadow-lg">
                <div class="text-3xl mb-2">üë®‚Äç‚öñÔ∏è</div>
                <div class="text-xl">Acceso Jurados</div>
                <div class="text-sm opacity-90 mt-1">Panel de evaluaci√≥n para jurados</div>
            </a>

            <!-- VOTACI√ìN DEL P√öBLICO -->
            <a href="voting_page.html" 
               class="btn block w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-6 px-8 rounded-xl text-center shadow-lg">
                <div class="text-3xl mb-2">üó≥Ô∏è</div>
                <div class="text-xl">Votar Artistas</div>
                <div class="text-sm opacity-90 mt-1">Votaci√≥n p√∫blica con tu entrada</div>
            </a>

            <!-- INFORMACI√ìN DEL EVENTO ACTIVO -->
            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 mt-6">
                <h3 class="text-lg font-bold text-green-400 mb-3">‚ÑπÔ∏è Informaci√≥n del Evento</h3>
                <div class="space-y-2 text-sm text-gray-300">
                    <p><strong>Evento:</strong> <span id="event-name-display">-</span></p>
                    <p><strong>Fecha:</strong> <span id="event-date-display">-</span></p>
                    <p class="text-xs text-gray-500 mt-4">Este es el evento activo configurado por el organizador</p>
                </div>
            </div>

            <!-- COMPARTIR -->
            <div class="text-center mt-6 pt-6 border-t border-gray-700">
                <p class="text-gray-400 text-sm mb-3">Compartir este acceso r√°pido:</p>
                <button onclick="compartirLink()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg">
                    üì± Compartir por WhatsApp
                </button>
                <button onclick="copiarLink()" class="ml-3 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg">
                    üìã Copiar Link
                </button>
            </div>
        </div>

        <div id="error-section" class="hidden text-center py-8">
            <div class="text-6xl mb-4">‚ö†Ô∏è</div>
            <h2 class="text-2xl font-bold text-red-400 mb-2">No hay evento activo</h2>
            <p class="text-gray-400">Contacta al organizador para activar un evento</p>
        </div>
    </div>

    <script type="module">
        import { db } from './firebase_config.js';
        import { collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const loadingSection = document.getElementById('loading-section');
        const contentSection = document.getElementById('content-section');
        const errorSection = document.getElementById('error-section');
        const eventTitle = document.getElementById('event-title');
        const eventNameDisplay = document.getElementById('event-name-display');
        const eventDateDisplay = document.getElementById('event-date-display');

        async function detectarEventoActivo() {
            try {
                const eventsRef = collection(db, 'events');
                const activeQuery = query(eventsRef, where('isActive', '==', true));
                const activeSnapshot = await getDocs(activeQuery);

                if (!activeSnapshot.empty) {
                    const activeEvent = activeSnapshot.docs[0];
                    const eventData = activeEvent.data();
                    const eventId = activeEvent.id;

                    // Actualizar UI
                    eventTitle.textContent = `üé™ ${eventData.name}`;
                    eventNameDisplay.textContent = eventData.name;
                    eventDateDisplay.textContent = eventData.date || 'No especificada';

                    // Guardar en localStorage para que las p√°ginas lo usen
                    localStorage.setItem('activeEventId', eventId);
                    localStorage.setItem('activeEventName', eventData.name);
                    localStorage.setItem('activeEventDate', eventData.date || '');

                    // Actualizar links con el eventId
                    const links = document.querySelectorAll('a[href*=".html"]');
                    links.forEach(link => {
                        const href = link.getAttribute('href');
                        if (href.includes('?')) {
                            link.setAttribute('href', href + `&eventId=${eventId}`);
                        } else {
                            link.setAttribute('href', href + `?eventId=${eventId}`);
                        }
                    });

                    // Mostrar contenido
                    loadingSection.classList.add('hidden');
                    contentSection.classList.remove('hidden');
                } else {
                    // No hay evento activo
                    loadingSection.classList.add('hidden');
                    errorSection.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error detectando evento activo:', error);
                loadingSection.classList.add('hidden');
                errorSection.classList.remove('hidden');
            }
        }

        window.compartirLink = function() {
            const url = window.location.href;
            const mensaje = `üé™ Acceso directo al evento VYT-MUSIC\n\nEsc√°ner, votaci√≥n de jurados y p√∫blico:\n${url}`;
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
            window.open(whatsappUrl, '_blank');
        };

        window.copiarLink = function() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('‚úÖ Link copiado al portapapeles');
            }).catch(err => {
                console.error('Error copiando:', err);
                prompt('Copia este link:', url);
            });
        };

        // Cargar al inicio
        detectarEventoActivo();
    </script>
</body>
</html>
